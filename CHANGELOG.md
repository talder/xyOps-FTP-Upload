# Changelog

All notable changes to the **xyOps FTP Upload** plugin will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/).

---

## [1.2.0] — 2026-02-21

### Changed
- **Plugin type changed from `action` to `event`** — FTP Upload now runs as a workflow step with direct access to files from previous steps
- Simplified STDIN handling for event plugin wire protocol (`cwd` and `input` at top level)
- Removed action-plugin workarounds for inaccessible temp directories
- `jobfiles` file source now works correctly — xyOps pre-downloads files into the plugin's CWD
- Updated README, examples, and Quick Start for event plugin workflow usage

---

## [1.1.0] — 2026-02-21

### Added
- **New file source: `Previous job files` (`jobfiles`)** — upload actual files generated by the previous event plugin
- Supports dynamic/timestamped filenames from upstream jobs (e.g., `netbox_tags_20260221_143022.csv`)
- Files are discovered automatically from `input.files` metadata provided by xyOps
- No configuration needed — just select the file source; all previous job files are uploaded automatically
- Now **4 file sources** total: local, content, jobdata, jobfiles

### Changed
- `Resolve-UploadFiles` now accepts a `$Cwd` parameter for resolving job file paths
- `Invoke-FTPUpload` passes through `$Cwd` from the main entry point
- Updated `fileSource` parameter options to include "Previous job files"

---

## [1.0.0] — 2026-02-21

### Added
- Initial release
- **3 protocols:** FTP (plain), FTPS (Explicit + Implicit TLS), SFTP (SSH)
- **3 file sources:** local file/folder, raw text content, previous job output
- **6 secrets** in xyOps Secret Vault (`FTP_HOST`, `FTP_PORT`, `FTP_USERNAME`, `FTP_PASSWORD`, `FTP_SSH_KEY_PATH`, `FTP_SSH_KEY_PASSPHRASE`) — all overridable via parameters
- **18 configurable parameters** for full control over upload behaviour
- **Posh-SSH auto-installation** — automatically installs the Posh-SSH module on first SFTP use
- **FTP/FTPS Explicit** via .NET `System.Net.FtpWebRequest` (port 21, STARTTLS)
- **FTPS Implicit** via custom `TcpClient` + `SslStream` implementation (port 990, direct TLS)
- **SFTP** via Posh-SSH module with password and SSH key auth (RSA, ED25519, ECDSA, DSA)
- Recursive folder upload with directory structure preservation
- Remote directory auto-creation (recursive `MKD` / `mkdir`)
- Configurable file-exists behaviour: overwrite, skip, or error
- Passive mode support for FTP/FTPS (default: enabled)
- Glob pattern support for multi-file uploads (e.g., `*.csv`)
- Comprehensive error handling with 13 categorised error types (connection, auth, permission, transfer, protocol)
- Structured JSON output data for downstream job chaining
- Progress reporting throughout the upload process
- Cross-platform support: Linux, Windows, macOS

### Notes
- Requires PowerShell 7.0+
- Requires secrets configured in the xyOps Secret Vault (or parameters provided directly)
- Posh-SSH module is auto-installed; no manual setup needed for SFTP
